<!doctype html><html lang="en"><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Demo – Run = Cycle</title>
<style>
:root {
  --neon-cyan: #00ffff;
  --neon-magenta: #ff00ff;
  --neon-green: #00ff00;
  --neon-yellow: #ffff00;
  --neon-purple: #8b00ff;
  --neon-orange: #ff4500;
  --dark-bg: #0a0a0a;
  --darker-bg: #050505;
  --pad: 24px;
}

* {
  box-sizing: border-box;
}

body {
  font: 16px/1.5 system-ui;
  margin: 2rem;
  max-width: 980px;
  color: #ffffff;
  background: var(--dark-bg);
  background: linear-gradient(135deg, #0a0a0a 0%, #1a0a1a 25%, #0a1a1a 50%, #1a1a0a 75%, #0a0a0a 100%);
  background-size: 400% 400%;
  animation: gradientShift 8s ease-in-out infinite;
}

@keyframes gradientShift {
  0%, 100% {
    background-position: 0% 50%;
  }
  50% {
    background-position: 100% 50%;
  }
}

h1 {
  font-size: 2.5rem;
  margin-bottom: 1rem;
  background: linear-gradient(45deg, var(--neon-cyan), var(--neon-magenta), var(--neon-green));
  background-size: 200% 200%;
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  animation: textShimmer 4s ease-in-out infinite;
}

@keyframes textShimmer {
  0%, 100% {
    background-position: 0% 50%;
  }
  50% {
    background-position: 100% 50%;
  }
}

label, select, button {
  font: inherit;
  color: #ffffff;
}

select {
  background: rgba(0, 255, 255, 0.1);
  border: 2px solid var(--neon-cyan);
  border-radius: 8px;
  padding: 0.5rem;
  color: var(--neon-cyan);
}

select option {
  background: var(--dark-bg);
  color: var(--neon-cyan);
}

button {
  background: transparent;
  border: 2px solid var(--neon-magenta);
  border-radius: 8px;
  padding: 0.6rem 1.2rem;
  color: var(--neon-magenta);
  cursor: pointer;
  transition: all 0.3s ease;
  font-weight: bold;
  text-transform: uppercase;
  letter-spacing: 1px;
}

button:hover {
  background: rgba(255, 0, 255, 0.1);
  box-shadow: 0 0 20px var(--neon-magenta);
  transform: translateY(-2px);
}

.row {
  display: flex;
  gap: 1rem;
  align-items: center;
  margin: .5rem 0;
  flex-wrap: wrap;
}

pre {
  background: rgba(0, 255, 255, 0.05);
  border: 1px solid rgba(0, 255, 255, 0.3);
  padding: 1rem;
  border-radius: 12px;
  overflow: auto;
  color: var(--neon-cyan);
  font-family: 'Courier New', monospace;
}

.badge {
  padding: .4rem .8rem;
  border: 2px solid var(--neon-green);
  border-radius: 8px;
  background: rgba(0, 255, 0, 0.1);
  color: var(--neon-green);
  font-weight: bold;
  animation: badgePulse 2s ease-in-out infinite;
}

@keyframes badgePulse {
  0%, 100% {
    box-shadow: 0 0 10px rgba(0, 255, 0, 0.3);
  }
  50% {
    box-shadow: 0 0 20px rgba(0, 255, 0, 0.5);
  }
}

.card {
  border: 2px solid rgba(255, 255, 255, 0.2);
  border-radius: 15px;
  padding: var(--pad);
  margin-top: 1rem;
  background: rgba(255, 255, 255, 0.02);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.small {
  opacity: .8;
  font-size: .9rem;
  color: #e0e0e0;
}

svg {
  width: 100%;
  height: 320px;
  border: 2px dashed rgba(0, 255, 255, 0.3);
  border-radius: 12px;
  background: rgba(0, 0, 0, 0.5);
}

.node {
  cursor: default;
}

.tooltip {
  margin-top: .25rem;
  padding: .6rem .8rem;
  border: 2px solid rgba(255, 255, 0, 0.5);
  border-radius: 10px;
  background: rgba(255, 255, 0, 0.05);
  color: var(--neon-yellow);
  font-weight: 500;
}

.legend {
  display: flex;
  gap: 1rem;
  align-items: center;
  margin-top: .5rem;
  justify-content: center;
  flex-wrap: wrap;
}

.dot {
  width: 12px;
  height: 12px;
  border-radius: 50%;
  display: inline-block;
  border: 2px solid rgba(255, 255, 255, 0.5);
  box-shadow: 0 0 10px currentColor;
}

.legend span {
  color: #e0e0e0;
}
</style>

<h1>Run = Cycle</h1>
<p class="small">Select two houses — the <em>Run</em> reveals resonance. No conducting, just coupling to the CORE.</p>

<div class="row card">
  <label for="a">House A:</label>
  <select id="a">
    <option>NNO</option><option>ONO</option><option>OSO</option><option>SSO</option>
    <option>SSW</option><option>WSW</option><option>WNW</option><option>NNW</option>
  </select>

  <label for="b">House B:</label>
  <select id="b">
    <option>ONO</option><option>OSO</option><option>SSO</option><option>SSW</option>
    <option>WSW</option><option>WNW</option><option>NNW</option><option>NNO</option>
  </select>

  <button id="run">Start run</button>
  <div id="status" class="badge">ready</div>
</div>

<div class="card">
  <svg id="viz" viewBox="0 0 800 320" aria-label="Resonance graph">
    <!-- filled via JS -->
  </svg>
  <div id="tip" class="tooltip" aria-live="polite">—</div>
  <div class="legend">
    <span class="dot" style="background:#00ffff"></span><span class="small">neutral</span>
    <span class="dot" style="background:#00ff00"></span><span class="small">neighbor</span>
    <span class="dot" style="background:#ff4500"></span><span class="small">complement</span>
  </div>
</div>

<div class="card">
  <h2>Result (JSON)</h2>
  <pre id="out">—</pre>
</div>

<p class="small">More about the Target Map: <a href="/about.html">What is the Resonance Gateway?</a></p>

<script>
const svg = document.getElementById('viz');
const tip = document.getElementById('tip');
function colorFor(type){
  if(type==="complement") return "#ff4500"; // neon orange
  if(type==="neighbor") return "#00ff00"; // neon green
  return "#00ffff"; // neon cyan for neutral
}
function renderGraph(json){
  svg.innerHTML="";
  const W=800,H=320, cx=W/2, cy=H/2;
  const A={x:160,y:cy}, CORE={x:cx,y:cy}, B={x:W-160,y:cy};
  const abEdge = json.edges.find(e=>e.from!=="CORE" && e.to!=="CORE") || {};
  const type = abEdge.type || "neutral";

  // edges
  const line = (p,q,cls)=> {
    const l=document.createElementNS("http://www.w3.org/2000/svg","line");
    l.setAttribute("x1",p.x); l.setAttribute("y1",p.y);
    l.setAttribute("x2",q.x); l.setAttribute("y2",q.y);
    l.setAttribute("stroke", colorFor(cls)); l.setAttribute("stroke-width","3");
    l.setAttribute("stroke-linecap","round");
    svg.appendChild(l); return l;
  };
  line(A,CORE,"neutral"); line(CORE,B,"neutral");
  const pulse = line(A,B,type);
  pulse.setAttribute("stroke-dasharray","6 6");
  let d=0; (function anim(){ d=(d+1)%12; pulse.setAttribute("stroke-dashoffset", d); requestAnimationFrame(anim); })();

  // nodes
  function node(p,label,fill="#fff"){
    const g=document.createElementNS("http://www.w3.org/2000/svg","g");
    g.setAttribute("class","node");
    const c=document.createElementNS("http://www.w3.org/2000/svg","circle");
    c.setAttribute("cx",p.x); c.setAttribute("cy",p.y); c.setAttribute("r","26");
    c.setAttribute("fill",fill); c.setAttribute("stroke","#111"); c.setAttribute("stroke-width","1.5");
    const t=document.createElementNS("http://www.w3.org/2000/svg","text");
    t.setAttribute("x",p.x); t.setAttribute("y",p.y+5); t.setAttribute("text-anchor","middle");
    t.setAttribute("font-size","14"); t.textContent=label;
    g.appendChild(c); g.appendChild(t); svg.appendChild(g);
  }
  node(A, json.nodes.find(n=>n.role==="source").id);
  node(CORE, "CORE", "#f8f8f8");
  node(B, json.nodes.find(n=>n.role==="target").id);

  tip.textContent = json.commentary;
  document.getElementById('out').textContent = JSON.stringify(json,null,2);
}

async function run(){
  const a=document.getElementById('a').value, b=document.getElementById('b').value;
  const status=document.getElementById('status');
  status.textContent="running…";
  try{
    const res=await fetch(`/.netlify/functions/resonance?houseA=${a}&houseB=${b}`);
    const json=await res.json();
    renderGraph(json);
    status.textContent="done";
  }catch(e){
    tip.textContent="Error: "+e;
    status.textContent="error";
  }
}
document.getElementById('run').addEventListener('click',run);
run(); // initial
</script>
</html>
