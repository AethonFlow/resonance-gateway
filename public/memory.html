<!doctype html><html lang="en"><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Memory — Cycles</title>
<style>
body{font:16px/1.5 system-ui;margin:2rem;max-width:980px;color:#111}
h1{margin-bottom:.25rem} .small{opacity:.8}
.card{border:1px solid #e6e6e6;border-radius:12px;padding:16px;margin:.75rem 0}
pre{background:#f7f7f7;padding:12px;border-radius:8px;overflow:auto}
.badge{padding:.2rem .5rem;border:1px solid #ddd;border-radius:6px}
button{font:inherit;padding:.45rem .75rem;border:1px solid #ccc;border-radius:8px;background:#fff;cursor:pointer}
button:hover{background:#f4f4f4}
.list{display:flex;gap:.5rem;flex-wrap:wrap}
.item{padding:.35rem .6rem;border:1px solid #ddd;border-radius:999px}
</style>

<h1>Cycles Memory</h1>
<p class="small">Browse recent cycles stored in Netlify Blobs (WSW → WNW → ONO → Core).</p>

<div class="card">
  <button id="reload">Reload</button>
  <span id="status" class="badge">idle</span>
  <div id="cycles" class="list" style="margin-top:.5rem"></div>
</div>

<div class="card">
  <h2 id="title">Cycle</h2>
  <pre id="json">—</pre>
</div>

<script>
const $ = (id)=>document.getElementById(id);

async function get(url){
  const r = await fetch(url);
  if(!r.ok) throw new Error(r.status + " " + r.statusText);
  return r.json();
}

async function loadList(){
  $("status").textContent = "loading…";
  const res = await get("/.netlify/functions/memory");
  const list = res.global?.lastCycles || [];
  const box = $("cycles");
  box.innerHTML = "";
  if(list.length === 0){
    box.textContent = "No cycles yet. Run WSW in the demo to create one.";
  } else {
    list.forEach(id=>{
      const a = document.createElement("button");
      a.className = "item";
      a.textContent = id;
      a.onclick = ()=>loadDetail(id);
      box.appendChild(a);
    });
  }
  $("status").textContent = "ready";
}

async function loadDetail(id){
  $("status").textContent = "loading " + id + "…";
  const res = await get("/.netlify/functions/memory?cycleId=" + encodeURIComponent(id));
  $("title").textContent = "Cycle " + id;
  $("json").textContent = JSON.stringify(res, null, 2);
  $("status").textContent = "ready";
}

$("reload").onclick = loadList;
loadList();
</script>
</html>
